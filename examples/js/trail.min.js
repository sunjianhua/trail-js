(function(){"use strict";var t=this,e=e||{};e.sayHi=function(){console.log("%c trail.js* init \n","background: #ff1234; color: #ffffff")},e.Mesh=function(){this.polygons=[],this.polygonLinks=[]},e.Mesh.prototype.getPolygons=function(){return this.polygons},e.Mesh.prototype.getPolygon=function(t){return this.polygons[t]},e.Mesh.prototype.addPolygon=function(t){this.polygons.push(t)},e.Mesh.prototype.constructor=e.Mesh,e.Polygon=function(t){this.vertices=[],this.edges=[],this.calcs=[];for(var n=0;n<t.length;n+=2){var r=new e.Vertex(t[n],t[n+1]);this.vertices.push(r)}for(var n=0;n<this.vertices.length;n++){var i,s,o;n!=this.vertices.length-1?(i=e.generateHash(this.vertices[n].x)+e.generateHash(this.vertices[n].y),s=e.generateHash(this.vertices[n+1].x)+e.generateHash(this.vertices[n+1].y),this.calcs.push(this.vertices[n].x+this.vertices[n].y+this.vertices[n+1].x+this.vertices[n+1].y),o=i+s):(i=e.generateHash(this.vertices[this.vertices.length-1].x)+e.generateHash(this.vertices[0].y),s=e.generateHash(this.vertices[this.vertices.length-1].x)+e.generateHash(this.vertices[0].y),this.calcs.push(this.vertices[n].x+this.vertices[n].y+this.vertices[0].x+this.vertices[0].y),o=i+s),this.edges.push(o)}console.log(this.calcs),console.log(this.edges)},e.Polygon.prototype.setVertices=function(t){this.vertices=[],this.edges=[];for(var e=0;e<t.length;e++)this.vertices.push(t[e])},e.Polygon.prototype.getVertices=function(){return this.vertices},e.Polygon.prototype.getVertex=function(t){return this.vertices[t]},e.Polygon.prototype.getEdges=function(){return this.edges},e.Polygon.prototype.setVertex=function(t,e){this.vertices[t]=e},e.Polygon.prototype.constructor=e.Polygon,e.Vertex=function(t,e){this.x=t,this.y=e},e.Vertex.prototype.constructor=e.Vertex;var n={};n.IsSimple=function(t){var e=t.length>>1;if(4>e)return!0;for(var r=new n._P,i=new n._P,s=new n._P,o=new n._P,h=new n._P,a=0;e>a;a++){r.x=t[2*a],r.y=t[2*a+1],a==e-1?(i.x=t[0],i.y=t[1]):(i.x=t[2*a+2],i.y=t[2*a+3]);for(var u=0;e>u;u++)if(!(Math.abs(a-u)<2||u==e-1&&0==a||a==e-1&&0==u||(s.x=t[2*u],s.y=t[2*u+1],u==e-1?(o.x=t[0],o.y=t[1]):(o.x=t[2*u+2],o.y=t[2*u+3]),null==n._GetLineIntersection(r,i,s,o,h))))return!1}return!0},n.IsConvex=function(t){if(t.length<6)return!0;for(var e=t.length-4,r=0;e>r;r+=2)if(!n._convex(t[r],t[r+1],t[r+2],t[r+3],t[r+4],t[r+5]))return!1;return n._convex(t[e],t[e+1],t[e+2],t[e+3],t[0],t[1])?n._convex(t[e+2],t[e+3],t[0],t[1],t[2],t[3])?!0:!1:!1},n.GetArea=function(t){if(t.length<6)return 0;for(var e=t.length-2,n=0,r=0;e>r;r+=2)n+=(t[r+2]-t[r])*(t[r+1]+t[r+3]);return n+=(t[0]-t[e])*(t[e+1]+t[1]),.5*-n},n.GetAABB=function(t){for(var e=1/0,n=1/0,r=-e,i=-n,s=0;s<t.length;s+=2)e=Math.min(e,t[s]),r=Math.max(r,t[s]),n=Math.min(n,t[s+1]),i=Math.max(i,t[s+1]);return{x:e,y:n,width:r-e,height:i-n}},n.Reverse=function(t){for(var e=[],n=t.length-2;n>=0;n-=2)e.push(t[n],t[n+1]);return e},n.Triangulate=function(t){var e=t.length>>1;if(3>e)return[];for(var r=[],i=[],s=0;e>s;s++)i.push(s);for(var s=0,o=e;o>3;){var h=i[(s+0)%o],a=i[(s+1)%o],u=i[(s+2)%o],y=t[2*h],f=t[2*h+1],l=t[2*a],c=t[2*a+1],x=t[2*u],g=t[2*u+1],v=!1;if(n._convex(y,f,l,c,x,g)){v=!0;for(var p=0;o>p;p++){var d=i[p];if(d!=h&&d!=a&&d!=u&&n._PointInTriangle(t[2*d],t[2*d+1],y,f,l,c,x,g)){v=!1;break}}}if(v)r.push(h,a,u),i.splice((s+1)%o,1),o--,s=0;else if(s++>3*o)break}return r.push(i[0],i[1],i[2]),r},n.ContainsPoint=function(t,e,n){for(var r,i=t.length>>1,s=t[2*i-3]-n,o=t[2*i-2]-e,h=t[2*i-1]-n,a=0;i>a;a++)r=o,s=h,o=t[2*a]-e,h=t[2*a+1]-n,s!=h&&(lup=h>s);for(var u=0,a=0;i>a;a++)if(r=o,s=h,o=t[2*a]-e,h=t[2*a+1]-n,!(0>s&&0>h||s>0&&h>0||0>r&&0>o)){if(s==h&&Math.min(r,o)<=0)return!0;if(s!=h){var y=r+(o-r)*-s/(h-s);if(0==y)return!0;y>0&&u++,0==s&&lup&&h>s&&u--,0==s&&!lup&&s>h&&u--,lup=h>s}}return 1==(1&u)},n.Slice=function(t,e,r,i,s){if(n.ContainsPoint(t,e,r)||n.ContainsPoint(t,i,s))return[t.slice(0)];for(var o=new n._P(e,r),h=new n._P(i,s),a=[],u=[],y=0;y<t.length;y+=2)u.push(new n._P(t[y],t[y+1]));for(var y=0;y<u.length;y++){var f=new n._P(0,0);f=n._GetLineIntersection(o,h,u[y],u[(y+1)%u.length],f),f&&(f.flag=!0,a.push(f),u.splice(y+1,0,f),y++)}if(0==a.length)return[t.slice(0)];var l=function(t,e){return n._P.dist(o,t)-n._P.dist(o,e)};a.sort(l);for(var c=[],x=0;a.length>0;){var g=(u.length,a[0]),v=a[1],p=u.indexOf(g),d=u.indexOf(v),_=!1;if(n._firstWithFlag(u,p)==d?_=!0:(g=a[1],v=a[0],p=u.indexOf(g),d=u.indexOf(v),n._firstWithFlag(u,p)==d&&(_=!0)),_){x--;var P=n._getPoints(u,p,d);c.push(P),u=n._getPoints(u,d,p),g.flag=v.flag=!1,a.splice(0,2),0==a.length&&c.push(u)}else x++,a.reverse();if(x>1)break}for(var m=[],y=0;y<c.length;y++){for(var M=c[y],I=[],w=0;w<M.length;w++)I.push(M[w].x,M[w].y);m.push(I)}return m},n.Raycast=function(t,e,r,i,s,o){var h=t.length-2,a=n._tp,u=a[0],y=a[1],f=a[2],l=a[3],c=a[4];u.x=e,u.y=r,y.x=e+i,y.y=r+s,null==o&&(o={dist:0,edge:0,norm:{x:0,y:0},refl:{x:0,y:0}}),o.dist=1/0;for(var x=0;h>x;x+=2){f.x=t[x],f.y=t[x+1],l.x=t[x+2],l.y=t[x+3];var g=n._RayLineIntersection(u,y,f,l,c);g&&n._updateISC(i,s,u,f,l,c,x/2,o)}f.x=l.x,f.y=l.y,l.x=t[0],l.y=t[1];var g=n._RayLineIntersection(u,y,f,l,c);return g&&n._updateISC(i,s,u,f,l,c,t.length/2,o),1/0!=o.dist?o:null},n.ClosestEdge=function(t,e,r,i){{var s=t.length-2,o=n._tp,h=o[0],a=o[2],u=o[3];o[4]}h.x=e,h.y=r,null==i&&(i={dist:0,edge:0,point:{x:0,y:0},norm:{x:0,y:0}}),i.dist=1/0;for(var y=0;s>y;y+=2)a.x=t[y],a.y=t[y+1],u.x=t[y+2],u.y=t[y+3],n._pointLineDist(h,a,u,y>>1,i);a.x=u.x,a.y=u.y,u.x=t[0],u.y=t[1],n._pointLineDist(h,a,u,s>>1,i);var f=1/i.dist;return i.norm.x=(e-i.point.x)*f,i.norm.y=(r-i.point.y)*f,i},n._pointLineDist=function(t,e,n,r,i){var s,o,h=t.x,a=t.y,u=e.x,y=e.y,f=n.x,l=n.y,c=h-u,x=a-y,g=f-u,v=l-y,p=c*g+x*v,d=g*g+v*v,_=p/d;0>_||u==f&&y==l?(s=u,o=y):_>1?(s=f,o=l):(s=u+_*g,o=y+_*v);var P=h-s,m=a-o,M=Math.sqrt(P*P+m*m);M<i.dist&&(i.dist=M,i.edge=r,i.point.x=s,i.point.y=o)},n._updateISC=function(t,e,r,i,s,o,h,a){var u=n._P.dist(r,o);if(u<a.dist){var y=1/n._P.dist(i,s),f=-(s.y-i.y)*y,l=(s.x-i.x)*y,c=2*(t*f+e*l);a.dist=u,a.norm.x=f,a.norm.y=l,a.refl.x=-c*f+t,a.refl.y=-c*l+e,a.edge=h}},n._getPoints=function(t,e,n){var r=t.length,i=[];e>n&&(n+=r);for(var s=e;n>=s;s++)i.push(t[s%r]);return i},n._firstWithFlag=function(t,e){for(var n=t.length;;)if(e=(e+1)%n,t[e].flag)return e},n._PointInTriangle=function(t,e,n,r,i,s,o,h){var a=o-n,u=h-r,y=i-n,f=s-r,l=t-n,c=e-r,x=a*a+u*u,g=a*y+u*f,v=a*l+u*c,p=y*y+f*f,d=y*l+f*c,_=1/(x*p-g*g),P=(p*v-g*d)*_,m=(x*d-g*v)*_;return P>=0&&m>=0&&1>P+m},n._RayLineIntersection=function(t,e,r,i,s){var o=t.x-e.x,h=r.x-i.x,a=t.y-e.y,u=r.y-i.y,y=o*u-a*h;if(0==y)return null;var f=t.x*e.y-t.y*e.x,l=r.x*i.y-r.y*i.x,c=s,x=1/y;return c.x=(f*h-o*l)*x,c.y=(f*u-a*l)*x,n._InRect(c,r,i)?a>0&&c.y>t.y||0>a&&c.y<t.y?null:o>0&&c.x>t.x||0>o&&c.x<t.x?null:c:null},n._GetLineIntersection=function(t,e,r,i,s){var o=t.x-e.x,h=r.x-i.x,a=t.y-e.y,u=r.y-i.y,y=o*u-a*h;if(0==y)return null;var f=t.x*e.y-t.y*e.x,l=r.x*i.y-r.y*i.x,c=s;return c.x=(f*h-o*l)/y,c.y=(f*u-a*l)/y,n._InRect(c,t,e)&&n._InRect(c,r,i)?c:null},n._InRect=function(t,e,n){return e.x==n.x?t.y>=Math.min(e.y,n.y)&&t.y<=Math.max(e.y,n.y):e.y==n.y?t.x>=Math.min(e.x,n.x)&&t.x<=Math.max(e.x,n.x):t.x>=Math.min(e.x,n.x)&&t.x<=Math.max(e.x,n.x)&&t.y>=Math.min(e.y,n.y)&&t.y<=Math.max(e.y,n.y)?!0:!1},n._convex=function(t,e,n,r,i,s){return(e-r)*(i-n)+(n-t)*(s-r)>=0},n._P=function(t,e){this.x=t,this.y=e,this.flag=!1},n._P.prototype.toString=function(){return"Point ["+this.x+", "+this.y+"]"},n._P.dist=function(t,e){var n=e.x-t.x,r=e.y-t.y;return Math.sqrt(n*n+r*r)},n._tp=[];for(var r=0;10>r;r++)n._tp.push(new n._P(0,0));e.verticesFromPolygon=function(t){for(var e=t.getVertices(),n=[],r=0;r<e.length;r++){var i=e[r];n.push(i.x,i.y)}return n},e.trianglesFromVertexArray=function(t){for(var n=[],r=0;r<t.length/6;r+=6){new e.Polygon([r,r+1,r+2,r+3,r+4,r+5])}return n},e.generateHash=function(t){return t=61^t^t>>16,t+=t<<3,t^=t>>4,t*=668265261,t^=t>>15},"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=e),exports.TRAIL=e):"undefined"!=typeof define&&define.amd?define(e):t.TRAIL=e}).call(this);