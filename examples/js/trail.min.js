(function(){"use strict";var t=this,e=e||{};e.sayHi=function(){console.log("%c trail.js* init \n","background: #ff1234; color: #ffffff")},e.Mesh=function(){this.polygons=[],this.vertices=[],this.edges=[]},e.Mesh.prototype.getVertex=function(t){return this.vertices[t]},e.Mesh.prototype.getVertices=function(){return this.vertices},e.Mesh.prototype.addVertexByXY=function(){var t=new e.Vertex(vertices[r],vertices[r+1]),n=t.x+t.y;void 0==this.vertices[n]?this.vertices[n]=t:console.log("Vertex already exists - skipping")},e.Mesh.prototype.setVerticesByXY=function(t){this.vertices=[];for(var n=0;n<t.length;n+=2){var r=new e.Vertex(t[n],t[n+1]),i=r.x+r.y;void 0==this.vertices[i]?this.vertices[i]=r:console.log("Vertex already exists - skipping")}},e.Mesh.prototype.getPolygons=function(){return this.polygons},e.Mesh.prototype.addPolygonByHashes=function(t){if(!(3>t)){for(var n=[],r=0;r<t.length;r++){if(void 0==this.vertices[t[r]])return;n.push(this.vertices[t[r]])}var i=new e.Polygon;i.setVertices(n),this.polygons.push(i)}},e.Mesh.prototype.constructor=e.Mesh,e.Polygon=function(){this.vertices=[]},e.Polygon.prototype.setVertices=function(t){this.vertices=[];for(var e=0;e<t.length;e++)this.vertices.push(t[e])},e.Polygon.prototype.getVertices=function(){return this.vertices},e.Polygon.prototype.constructor=e.Polygon,e.Vertex=function(t,e){this.x=t,this.y=e},e.Vertex.prototype.constructor=e.Vertex;var n={};n.IsSimple=function(t){var e=t.length>>1;if(4>e)return!0;for(var r=new n._P,i=new n._P,o=new n._P,s=new n._P,u=new n._P,a=0;e>a;a++){r.x=t[2*a],r.y=t[2*a+1],a==e-1?(i.x=t[0],i.y=t[1]):(i.x=t[2*a+2],i.y=t[2*a+3]);for(var f=0;e>f;f++)if(!(Math.abs(a-f)<2||f==e-1&&0==a||a==e-1&&0==f||(o.x=t[2*f],o.y=t[2*f+1],f==e-1?(s.x=t[0],s.y=t[1]):(s.x=t[2*f+2],s.y=t[2*f+3]),null==n._GetLineIntersection(r,i,o,s,u))))return!1}return!0},n.IsConvex=function(t){if(t.length<6)return!0;for(var e=t.length-4,r=0;e>r;r+=2)if(!n._convex(t[r],t[r+1],t[r+2],t[r+3],t[r+4],t[r+5]))return!1;return n._convex(t[e],t[e+1],t[e+2],t[e+3],t[0],t[1])&&n._convex(t[e+2],t[e+3],t[0],t[1],t[2],t[3])?!0:!1},n.GetArea=function(t){if(t.length<6)return 0;for(var e=t.length-2,n=0,r=0;e>r;r+=2)n+=(t[r+2]-t[r])*(t[r+1]+t[r+3]);return n+=(t[0]-t[e])*(t[e+1]+t[1]),.5*-n},n.GetAABB=function(t){for(var e=1/0,n=1/0,r=-e,i=-n,o=0;o<t.length;o+=2)e=Math.min(e,t[o]),r=Math.max(r,t[o]),n=Math.min(n,t[o+1]),i=Math.max(i,t[o+1]);return{x:e,y:n,width:r-e,height:i-n}},n.Reverse=function(t){for(var e=[],n=t.length-2;n>=0;n-=2)e.push(t[n],t[n+1]);return e},n.Triangulate=function(t){var e=t.length>>1;if(3>e)return[];for(var r=[],i=[],o=0;e>o;o++)i.push(o);for(var o=0,s=e;s>3;){var u=i[(o+0)%s],a=i[(o+1)%s],f=i[(o+2)%s],y=t[2*u],x=t[2*u+1],l=t[2*a],h=t[2*a+1],c=t[2*f],v=t[2*f+1],p=!1;if(n._convex(y,x,l,h,c,v)){p=!0;for(var g=0;s>g;g++){var d=i[g];if(d!=u&&d!=a&&d!=f&&n._PointInTriangle(t[2*d],t[2*d+1],y,x,l,h,c,v)){p=!1;break}}}if(p)r.push(u,a,f),i.splice((o+1)%s,1),s--,o=0;else if(o++>3*s)break}return r.push(i[0],i[1],i[2]),r},n.ContainsPoint=function(t,e,n){for(var r,i=t.length>>1,o=t[2*i-3]-n,s=t[2*i-2]-e,u=t[2*i-1]-n,a=0;i>a;a++)r=s,o=u,s=t[2*a]-e,u=t[2*a+1]-n,o!=u&&(lup=u>o);for(var f=0,a=0;i>a;a++)if(r=s,o=u,s=t[2*a]-e,u=t[2*a+1]-n,!(0>o&&0>u||o>0&&u>0||0>r&&0>s)){if(o==u&&Math.min(r,s)<=0)return!0;if(o!=u){var y=r+(s-r)*-o/(u-o);if(0==y)return!0;y>0&&f++,0==o&&lup&&u>o&&f--,0==o&&!lup&&o>u&&f--,lup=u>o}}return 1==(1&f)},n.Slice=function(t,e,r,i,o){if(n.ContainsPoint(t,e,r)||n.ContainsPoint(t,i,o))return[t.slice(0)];for(var s=new n._P(e,r),u=new n._P(i,o),a=[],f=[],y=0;y<t.length;y+=2)f.push(new n._P(t[y],t[y+1]));for(var y=0;y<f.length;y++){var x=new n._P(0,0);x=n._GetLineIntersection(s,u,f[y],f[(y+1)%f.length],x),x&&(x.flag=!0,a.push(x),f.splice(y+1,0,x),y++)}if(0==a.length)return[t.slice(0)];var l=function(t,e){return n._P.dist(s,t)-n._P.dist(s,e)};a.sort(l);for(var h=[],c=0;a.length>0;){var v=(f.length,a[0]),p=a[1],g=f.indexOf(v),d=f.indexOf(p),_=!1;if(n._firstWithFlag(f,g)==d?_=!0:(v=a[1],p=a[0],g=f.indexOf(v),d=f.indexOf(p),n._firstWithFlag(f,g)==d&&(_=!0)),_){c--;var P=n._getPoints(f,g,d);h.push(P),f=n._getPoints(f,d,g),v.flag=p.flag=!1,a.splice(0,2),0==a.length&&h.push(f)}else c++,a.reverse();if(c>1)break}for(var m=[],y=0;y<h.length;y++){for(var M=h[y],I=[],V=0;V<M.length;V++)I.push(M[V].x,M[V].y);m.push(I)}return m},n.Raycast=function(t,e,r,i,o,s){var u=t.length-2,a=n._tp,f=a[0],y=a[1],x=a[2],l=a[3],h=a[4];f.x=e,f.y=r,y.x=e+i,y.y=r+o,null==s&&(s={dist:0,edge:0,norm:{x:0,y:0},refl:{x:0,y:0}}),s.dist=1/0;for(var c=0;u>c;c+=2){x.x=t[c],x.y=t[c+1],l.x=t[c+2],l.y=t[c+3];var v=n._RayLineIntersection(f,y,x,l,h);v&&n._updateISC(i,o,f,x,l,h,c/2,s)}x.x=l.x,x.y=l.y,l.x=t[0],l.y=t[1];var v=n._RayLineIntersection(f,y,x,l,h);return v&&n._updateISC(i,o,f,x,l,h,t.length/2,s),1/0!=s.dist?s:null},n.ClosestEdge=function(t,e,r,i){{var o=t.length-2,s=n._tp,u=s[0],a=s[2],f=s[3];s[4]}u.x=e,u.y=r,null==i&&(i={dist:0,edge:0,point:{x:0,y:0},norm:{x:0,y:0}}),i.dist=1/0;for(var y=0;o>y;y+=2)a.x=t[y],a.y=t[y+1],f.x=t[y+2],f.y=t[y+3],n._pointLineDist(u,a,f,y>>1,i);a.x=f.x,a.y=f.y,f.x=t[0],f.y=t[1],n._pointLineDist(u,a,f,o>>1,i);var x=1/i.dist;return i.norm.x=(e-i.point.x)*x,i.norm.y=(r-i.point.y)*x,i},n._pointLineDist=function(t,e,n,r,i){var o,s,u=t.x,a=t.y,f=e.x,y=e.y,x=n.x,l=n.y,h=u-f,c=a-y,v=x-f,p=l-y,g=h*v+c*p,d=v*v+p*p,_=g/d;0>_||f==x&&y==l?(o=f,s=y):_>1?(o=x,s=l):(o=f+_*v,s=y+_*p);var P=u-o,m=a-s,M=Math.sqrt(P*P+m*m);M<i.dist&&(i.dist=M,i.edge=r,i.point.x=o,i.point.y=s)},n._updateISC=function(t,e,r,i,o,s,u,a){var f=n._P.dist(r,s);if(f<a.dist){var y=1/n._P.dist(i,o),x=-(o.y-i.y)*y,l=(o.x-i.x)*y,h=2*(t*x+e*l);a.dist=f,a.norm.x=x,a.norm.y=l,a.refl.x=-h*x+t,a.refl.y=-h*l+e,a.edge=u}},n._getPoints=function(t,e,n){var r=t.length,i=[];e>n&&(n+=r);for(var o=e;n>=o;o++)i.push(t[o%r]);return i},n._firstWithFlag=function(t,e){for(var n=t.length;;)if(e=(e+1)%n,t[e].flag)return e},n._PointInTriangle=function(t,e,n,r,i,o,s,u){var a=s-n,f=u-r,y=i-n,x=o-r,l=t-n,h=e-r,c=a*a+f*f,v=a*y+f*x,p=a*l+f*h,g=y*y+x*x,d=y*l+x*h,_=1/(c*g-v*v),P=(g*p-v*d)*_,m=(c*d-v*p)*_;return P>=0&&m>=0&&1>P+m},n._RayLineIntersection=function(t,e,r,i,o){var s=t.x-e.x,u=r.x-i.x,a=t.y-e.y,f=r.y-i.y,y=s*f-a*u;if(0==y)return null;var x=t.x*e.y-t.y*e.x,l=r.x*i.y-r.y*i.x,h=o,c=1/y;return h.x=(x*u-s*l)*c,h.y=(x*f-a*l)*c,n._InRect(h,r,i)?a>0&&h.y>t.y||0>a&&h.y<t.y?null:s>0&&h.x>t.x||0>s&&h.x<t.x?null:h:null},n._GetLineIntersection=function(t,e,r,i,o){var s=t.x-e.x,u=r.x-i.x,a=t.y-e.y,f=r.y-i.y,y=s*f-a*u;if(0==y)return null;var x=t.x*e.y-t.y*e.x,l=r.x*i.y-r.y*i.x,h=o;return h.x=(x*u-s*l)/y,h.y=(x*f-a*l)/y,n._InRect(h,t,e)&&n._InRect(h,r,i)?h:null},n._InRect=function(t,e,n){return e.x==n.x?t.y>=Math.min(e.y,n.y)&&t.y<=Math.max(e.y,n.y):e.y==n.y?t.x>=Math.min(e.x,n.x)&&t.x<=Math.max(e.x,n.x):t.x>=Math.min(e.x,n.x)&&t.x<=Math.max(e.x,n.x)&&t.y>=Math.min(e.y,n.y)&&t.y<=Math.max(e.y,n.y)?!0:!1},n._convex=function(t,e,n,r,i,o){return(e-r)*(i-n)+(n-t)*(o-r)>=0},n._P=function(t,e){this.x=t,this.y=e,this.flag=!1},n._P.prototype.toString=function(){return"Point ["+this.x+", "+this.y+"]"},n._P.dist=function(t,e){var n=e.x-t.x,r=e.y-t.y;return Math.sqrt(n*n+r*r)},n._tp=[];for(var r=0;10>r;r++)n._tp.push(new n._P(0,0));e.verticesFromPolygon=function(t){for(var e=t.getVertices(),n=[],r=0;r<e.length;r++){var i=e[r];n.push(i.x,i.y)}return n},e.trianglesFromVertexArray=function(t){for(var n=[],r=0;r<t.length/6;r+=6){new e.Polygon([r,r+1,r+2,r+3,r+4,r+5])}return n},"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=e),exports.TRAIL=e):"undefined"!=typeof define&&define.amd?define(e):t.TRAIL=e}).call(this);