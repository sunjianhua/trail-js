(function(){"use strict";var t=this,n=n||{};n.sayHi=function(){console.log("%c trail.js* init \n","background: #ff1234; color: #ffffff")},n.Point=function(t,n){this.x=t,this.y=n},n.Point.prototype.constructor=n.Point,n.Polygon=function(t){this.vertices=[];for(var e=0;e<t.length;e+=2)this.vertices.push(new n.Point(t[e],t[e+1]))},n.Polygon.prototype.getVertices=function(){return this.vertices},n.Polygon.prototype.isSimple=function(){var t=n.verticesFromPolygon(this);return e.IsSimple(t)},n.Polygon.prototype.isConvex=function(){var t=n.verticesFromPolygon(this);return e.IsConvex(t)},n.Polygon.prototype.triangulate=function(){if(1==this.isSimple()){for(var t=n.verticesFromPolygon(this),r=e.Triangulate(t),i=[],o=0;o<r.length;o+=3){var s=new n.Polygon([this.vertices[r[o]].x,this.vertices[r[o]].y,this.vertices[r[o+1]].x,this.vertices[r[o+1]].y,this.vertices[r[o+2]].x,this.vertices[r[o+2]].y]);i.push(s)}return i}return[]},n.Polygon.prototype.constructor=n.Polygon;var e={};e.IsSimple=function(t){var n=t.length>>1;if(4>n)return!0;for(var r=new e._P,i=new e._P,o=new e._P,s=new e._P,a=new e._P,u=0;n>u;u++){r.x=t[2*u],r.y=t[2*u+1],u==n-1?(i.x=t[0],i.y=t[1]):(i.x=t[2*u+2],i.y=t[2*u+3]);for(var f=0;n>f;f++)if(!(Math.abs(u-f)<2||f==n-1&&0==u||u==n-1&&0==f||(o.x=t[2*f],o.y=t[2*f+1],f==n-1?(s.x=t[0],s.y=t[1]):(s.x=t[2*f+2],s.y=t[2*f+3]),null==e._GetLineIntersection(r,i,o,s,a))))return!1}return!0},e.IsConvex=function(t){if(t.length<6)return!0;for(var n=t.length-4,r=0;n>r;r+=2)if(!e._convex(t[r],t[r+1],t[r+2],t[r+3],t[r+4],t[r+5]))return!1;return e._convex(t[n],t[n+1],t[n+2],t[n+3],t[0],t[1])&&e._convex(t[n+2],t[n+3],t[0],t[1],t[2],t[3])?!0:!1},e.GetArea=function(t){if(t.length<6)return 0;for(var n=t.length-2,e=0,r=0;n>r;r+=2)e+=(t[r+2]-t[r])*(t[r+1]+t[r+3]);return e+=(t[0]-t[n])*(t[n+1]+t[1]),.5*-e},e.GetAABB=function(t){for(var n=1/0,e=1/0,r=-n,i=-e,o=0;o<t.length;o+=2)n=Math.min(n,t[o]),r=Math.max(r,t[o]),e=Math.min(e,t[o+1]),i=Math.max(i,t[o+1]);return{x:n,y:e,width:r-n,height:i-e}},e.Reverse=function(t){for(var n=[],e=t.length-2;e>=0;e-=2)n.push(t[e],t[e+1]);return n},e.Triangulate=function(t){var n=t.length>>1;if(3>n)return[];for(var r=[],i=[],o=0;n>o;o++)i.push(o);for(var o=0,s=n;s>3;){var a=i[(o+0)%s],u=i[(o+1)%s],f=i[(o+2)%s],y=t[2*a],x=t[2*a+1],l=t[2*u],h=t[2*u+1],c=t[2*f],v=t[2*f+1],g=!1;if(e._convex(y,x,l,h,c,v)){g=!0;for(var p=0;s>p;p++){var _=i[p];if(_!=a&&_!=u&&_!=f&&e._PointInTriangle(t[2*_],t[2*_+1],y,x,l,h,c,v)){g=!1;break}}}if(g)r.push(a,u,f),i.splice((o+1)%s,1),s--,o=0;else if(o++>3*s)break}return r.push(i[0],i[1],i[2]),r},e.ContainsPoint=function(t,n,e){for(var r,i=t.length>>1,o=t[2*i-3]-e,s=t[2*i-2]-n,a=t[2*i-1]-e,u=0;i>u;u++)r=s,o=a,s=t[2*u]-n,a=t[2*u+1]-e,o!=a&&(lup=a>o);for(var f=0,u=0;i>u;u++)if(r=s,o=a,s=t[2*u]-n,a=t[2*u+1]-e,!(0>o&&0>a||o>0&&a>0||0>r&&0>s)){if(o==a&&Math.min(r,s)<=0)return!0;if(o!=a){var y=r+(s-r)*-o/(a-o);if(0==y)return!0;y>0&&f++,0==o&&lup&&a>o&&f--,0==o&&!lup&&o>a&&f--,lup=a>o}}return 1==(1&f)},e.Slice=function(t,n,r,i,o){if(e.ContainsPoint(t,n,r)||e.ContainsPoint(t,i,o))return[t.slice(0)];for(var s=new e._P(n,r),a=new e._P(i,o),u=[],f=[],y=0;y<t.length;y+=2)f.push(new e._P(t[y],t[y+1]));for(var y=0;y<f.length;y++){var x=new e._P(0,0);x=e._GetLineIntersection(s,a,f[y],f[(y+1)%f.length],x),x&&(x.flag=!0,u.push(x),f.splice(y+1,0,x),y++)}if(0==u.length)return[t.slice(0)];var l=function(t,n){return e._P.dist(s,t)-e._P.dist(s,n)};u.sort(l);for(var h=[],c=0;u.length>0;){var v=(f.length,u[0]),g=u[1],p=f.indexOf(v),_=f.indexOf(g),P=!1;if(e._firstWithFlag(f,p)==_?P=!0:(v=u[1],g=u[0],p=f.indexOf(v),_=f.indexOf(g),e._firstWithFlag(f,p)==_&&(P=!0)),P){c--;var d=e._getPoints(f,p,_);h.push(d),f=e._getPoints(f,_,p),v.flag=g.flag=!1,u.splice(0,2),0==u.length&&h.push(f)}else c++,u.reverse();if(c>1)break}for(var m=[],y=0;y<h.length;y++){for(var I=h[y],M=[],w=0;w<I.length;w++)M.push(I[w].x,I[w].y);m.push(M)}return m},e.Raycast=function(t,n,r,i,o,s){var a=t.length-2,u=e._tp,f=u[0],y=u[1],x=u[2],l=u[3],h=u[4];f.x=n,f.y=r,y.x=n+i,y.y=r+o,null==s&&(s={dist:0,edge:0,norm:{x:0,y:0},refl:{x:0,y:0}}),s.dist=1/0;for(var c=0;a>c;c+=2){x.x=t[c],x.y=t[c+1],l.x=t[c+2],l.y=t[c+3];var v=e._RayLineIntersection(f,y,x,l,h);v&&e._updateISC(i,o,f,x,l,h,c/2,s)}x.x=l.x,x.y=l.y,l.x=t[0],l.y=t[1];var v=e._RayLineIntersection(f,y,x,l,h);return v&&e._updateISC(i,o,f,x,l,h,t.length/2,s),1/0!=s.dist?s:null},e.ClosestEdge=function(t,n,r,i){{var o=t.length-2,s=e._tp,a=s[0],u=s[2],f=s[3];s[4]}a.x=n,a.y=r,null==i&&(i={dist:0,edge:0,point:{x:0,y:0},norm:{x:0,y:0}}),i.dist=1/0;for(var y=0;o>y;y+=2)u.x=t[y],u.y=t[y+1],f.x=t[y+2],f.y=t[y+3],e._pointLineDist(a,u,f,y>>1,i);u.x=f.x,u.y=f.y,f.x=t[0],f.y=t[1],e._pointLineDist(a,u,f,o>>1,i);var x=1/i.dist;return i.norm.x=(n-i.point.x)*x,i.norm.y=(r-i.point.y)*x,i},e._pointLineDist=function(t,n,e,r,i){var o,s,a=t.x,u=t.y,f=n.x,y=n.y,x=e.x,l=e.y,h=a-f,c=u-y,v=x-f,g=l-y,p=h*v+c*g,_=v*v+g*g,P=p/_;0>P||f==x&&y==l?(o=f,s=y):P>1?(o=x,s=l):(o=f+P*v,s=y+P*g);var d=a-o,m=u-s,I=Math.sqrt(d*d+m*m);I<i.dist&&(i.dist=I,i.edge=r,i.point.x=o,i.point.y=s)},e._updateISC=function(t,n,r,i,o,s,a,u){var f=e._P.dist(r,s);if(f<u.dist){var y=1/e._P.dist(i,o),x=-(o.y-i.y)*y,l=(o.x-i.x)*y,h=2*(t*x+n*l);u.dist=f,u.norm.x=x,u.norm.y=l,u.refl.x=-h*x+t,u.refl.y=-h*l+n,u.edge=a}},e._getPoints=function(t,n,e){var r=t.length,i=[];n>e&&(e+=r);for(var o=n;e>=o;o++)i.push(t[o%r]);return i},e._firstWithFlag=function(t,n){for(var e=t.length;;)if(n=(n+1)%e,t[n].flag)return n},e._PointInTriangle=function(t,n,e,r,i,o,s,a){var u=s-e,f=a-r,y=i-e,x=o-r,l=t-e,h=n-r,c=u*u+f*f,v=u*y+f*x,g=u*l+f*h,p=y*y+x*x,_=y*l+x*h,P=1/(c*p-v*v),d=(p*g-v*_)*P,m=(c*_-v*g)*P;return d>=0&&m>=0&&1>d+m},e._RayLineIntersection=function(t,n,r,i,o){var s=t.x-n.x,a=r.x-i.x,u=t.y-n.y,f=r.y-i.y,y=s*f-u*a;if(0==y)return null;var x=t.x*n.y-t.y*n.x,l=r.x*i.y-r.y*i.x,h=o,c=1/y;return h.x=(x*a-s*l)*c,h.y=(x*f-u*l)*c,e._InRect(h,r,i)?u>0&&h.y>t.y||0>u&&h.y<t.y?null:s>0&&h.x>t.x||0>s&&h.x<t.x?null:h:null},e._GetLineIntersection=function(t,n,r,i,o){var s=t.x-n.x,a=r.x-i.x,u=t.y-n.y,f=r.y-i.y,y=s*f-u*a;if(0==y)return null;var x=t.x*n.y-t.y*n.x,l=r.x*i.y-r.y*i.x,h=o;return h.x=(x*a-s*l)/y,h.y=(x*f-u*l)/y,e._InRect(h,t,n)&&e._InRect(h,r,i)?h:null},e._InRect=function(t,n,e){return n.x==e.x?t.y>=Math.min(n.y,e.y)&&t.y<=Math.max(n.y,e.y):n.y==e.y?t.x>=Math.min(n.x,e.x)&&t.x<=Math.max(n.x,e.x):t.x>=Math.min(n.x,e.x)&&t.x<=Math.max(n.x,e.x)&&t.y>=Math.min(n.y,e.y)&&t.y<=Math.max(n.y,e.y)?!0:!1},e._convex=function(t,n,e,r,i,o){return(n-r)*(i-e)+(e-t)*(o-r)>=0},e._P=function(t,n){this.x=t,this.y=n,this.flag=!1},e._P.prototype.toString=function(){return"Point ["+this.x+", "+this.y+"]"},e._P.dist=function(t,n){var e=n.x-t.x,r=n.y-t.y;return Math.sqrt(e*e+r*r)},e._tp=[];for(var r=0;10>r;r++)e._tp.push(new e._P(0,0));n.verticesFromPolygon=function(t){for(var n=t.getVertices(),e=[],r=0;r<n.length;r++){var i=n[r];e.push(i.x,i.y)}return e},n.trianglesFromVertexArray=function(t){for(var e=[],r=0;r<t.length/6;r+=6){new n.Polygon([r,r+1,r+2,r+3,r+4,r+5])}return e},"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=n),exports.TRAIL=n):"undefined"!=typeof define&&define.amd?define(n):t.TRAIL=n}).call(this);