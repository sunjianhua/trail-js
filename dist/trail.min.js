(function(){"use strict";var t=this,n=n||{};n.sayHi=function(){console.log("%c trail* init \n","background: #ff1234; color: #ffffff")},n.Point=function(t,n){this.x=t,this.y=n},n.Point.prototype.constructor=n.Point,n.Polygon=function(t){this.vertices=[];for(var e=0;e<t.length;e+=2)this.vertices.push(new n.Point(t[e],t[e+1]))},n.Polygon.prototype.getVertices=function(){return this.vertices},n.Polygon.prototype.isSimple=function(){return e.IsSimple(this.vertices)},n.Polygon.prototype.isConvex=function(){if(this.vertices.length<4)return!0;for(var t=!1,n=this.vertices.length,e=0;n>e;e++){var r=this.vertices[(e+2)%n].x-this.vertices[(e+1)%n].x,i=this.vertices[(e+2)%n].y-this.vertices[(e+1)%n].y,o=this.vertices[e].x-this.vertices[(e+1)%n].x,s=this.vertices[e].y-this.vertices[(e+1)%n].y,f=r*s-i*o;if(0==e)t=f>0;else if(t!=f>0)return!1}return!0},n.Polygon.prototype.constructor=n.Polygon;var e={};e.IsSimple=function(t){var n=t.length>>1;if(4>n)return!0;for(var r=new e._P,i=new e._P,o=new e._P,s=new e._P,f=new e._P,u=0;n>u;u++){r.x=t[2*u],r.y=t[2*u+1],u==n-1?(i.x=t[0],i.y=t[1]):(i.x=t[2*u+2],i.y=t[2*u+3]);for(var a=0;n>a;a++)if(!(Math.abs(u-a)<2||a==n-1&&0==u||u==n-1&&0==a||(o.x=t[2*a],o.y=t[2*a+1],a==n-1?(s.x=t[0],s.y=t[1]):(s.x=t[2*a+2],s.y=t[2*a+3]),null==e._GetLineIntersection(r,i,o,s,f))))return!1}return!0},e.IsConvex=function(t){if(t.length<6)return!0;for(var n=t.length-4,r=0;n>r;r+=2)if(!e._convex(t[r],t[r+1],t[r+2],t[r+3],t[r+4],t[r+5]))return!1;return e._convex(t[n],t[n+1],t[n+2],t[n+3],t[0],t[1])?e._convex(t[n+2],t[n+3],t[0],t[1],t[2],t[3])?!0:!1:!1},e.GetArea=function(t){if(t.length<6)return 0;for(var n=t.length-2,e=0,r=0;n>r;r+=2)e+=(t[r+2]-t[r])*(t[r+1]+t[r+3]);return e+=(t[0]-t[n])*(t[n+1]+t[1]),.5*-e},e.GetAABB=function(t){for(var n=1/0,e=1/0,r=-n,i=-e,o=0;o<t.length;o+=2)n=Math.min(n,t[o]),r=Math.max(r,t[o]),e=Math.min(e,t[o+1]),i=Math.max(i,t[o+1]);return{x:n,y:e,width:r-n,height:i-e}},e.Reverse=function(t){for(var n=[],e=t.length-2;e>=0;e-=2)n.push(t[e],t[e+1]);return n},e.Triangulate=function(t){var n=t.length>>1;if(3>n)return[];for(var r=[],i=[],o=0;n>o;o++)i.push(o);for(var o=0,s=n;s>3;){var f=i[(o+0)%s],u=i[(o+1)%s],a=i[(o+2)%s],x=t[2*f],y=t[2*f+1],l=t[2*u],h=t[2*u+1],c=t[2*a],v=t[2*a+1],p=!1;if(e._convex(x,y,l,h,c,v)){p=!0;for(var g=0;s>g;g++){var _=i[g];if(_!=f&&_!=u&&_!=a&&e._PointInTriangle(t[2*_],t[2*_+1],x,y,l,h,c,v)){p=!1;break}}}if(p)r.push(f,u,a),i.splice((o+1)%s,1),s--,o=0;else if(o++>3*s)break}return r.push(i[0],i[1],i[2]),r},e.ContainsPoint=function(t,n,e){for(var r,i=t.length>>1,o=t[2*i-3]-e,s=t[2*i-2]-n,f=t[2*i-1]-e,u=0;i>u;u++)r=s,o=f,s=t[2*u]-n,f=t[2*u+1]-e,o!=f&&(lup=f>o);for(var a=0,u=0;i>u;u++)if(r=s,o=f,s=t[2*u]-n,f=t[2*u+1]-e,!(0>o&&0>f||o>0&&f>0||0>r&&0>s)){if(o==f&&Math.min(r,s)<=0)return!0;if(o!=f){var x=r+(s-r)*-o/(f-o);if(0==x)return!0;x>0&&a++,0==o&&lup&&f>o&&a--,0==o&&!lup&&o>f&&a--,lup=f>o}}return 1==(1&a)},e.Slice=function(t,n,r,i,o){if(e.ContainsPoint(t,n,r)||e.ContainsPoint(t,i,o))return[t.slice(0)];for(var s=new e._P(n,r),f=new e._P(i,o),u=[],a=[],x=0;x<t.length;x+=2)a.push(new e._P(t[x],t[x+1]));for(var x=0;x<a.length;x++){var y=new e._P(0,0);y=e._GetLineIntersection(s,f,a[x],a[(x+1)%a.length],y),y&&(y.flag=!0,u.push(y),a.splice(x+1,0,y),x++)}if(0==u.length)return[t.slice(0)];var l=function(t,n){return e._P.dist(s,t)-e._P.dist(s,n)};u.sort(l);for(var h=[],c=0;u.length>0;){var v=(a.length,u[0]),p=u[1],g=a.indexOf(v),_=a.indexOf(p),d=!1;if(e._firstWithFlag(a,g)==_?d=!0:(v=u[1],p=u[0],g=a.indexOf(v),_=a.indexOf(p),e._firstWithFlag(a,g)==_&&(d=!0)),d){c--;var P=e._getPoints(a,g,_);h.push(P),a=e._getPoints(a,_,g),v.flag=p.flag=!1,u.splice(0,2),0==u.length&&h.push(a)}else c++,u.reverse();if(c>1)break}for(var m=[],x=0;x<h.length;x++){for(var I=h[x],M=[],w=0;w<I.length;w++)M.push(I[w].x,I[w].y);m.push(M)}return m},e.Raycast=function(t,n,r,i,o,s){var f=t.length-2,u=e._tp,a=u[0],x=u[1],y=u[2],l=u[3],h=u[4];a.x=n,a.y=r,x.x=n+i,x.y=r+o,null==s&&(s={dist:0,edge:0,norm:{x:0,y:0},refl:{x:0,y:0}}),s.dist=1/0;for(var c=0;f>c;c+=2){y.x=t[c],y.y=t[c+1],l.x=t[c+2],l.y=t[c+3];var v=e._RayLineIntersection(a,x,y,l,h);v&&e._updateISC(i,o,a,y,l,h,c/2,s)}y.x=l.x,y.y=l.y,l.x=t[0],l.y=t[1];var v=e._RayLineIntersection(a,x,y,l,h);return v&&e._updateISC(i,o,a,y,l,h,t.length/2,s),1/0!=s.dist?s:null},e.ClosestEdge=function(t,n,r,i){{var o=t.length-2,s=e._tp,f=s[0],u=s[2],a=s[3];s[4]}f.x=n,f.y=r,null==i&&(i={dist:0,edge:0,point:{x:0,y:0},norm:{x:0,y:0}}),i.dist=1/0;for(var x=0;o>x;x+=2)u.x=t[x],u.y=t[x+1],a.x=t[x+2],a.y=t[x+3],e._pointLineDist(f,u,a,x>>1,i);u.x=a.x,u.y=a.y,a.x=t[0],a.y=t[1],e._pointLineDist(f,u,a,o>>1,i);var y=1/i.dist;return i.norm.x=(n-i.point.x)*y,i.norm.y=(r-i.point.y)*y,i},e._pointLineDist=function(t,n,e,r,i){var o,s,f=t.x,u=t.y,a=n.x,x=n.y,y=e.x,l=e.y,h=f-a,c=u-x,v=y-a,p=l-x,g=h*v+c*p,_=v*v+p*p,d=g/_;0>d||a==y&&x==l?(o=a,s=x):d>1?(o=y,s=l):(o=a+d*v,s=x+d*p);var P=f-o,m=u-s,I=Math.sqrt(P*P+m*m);I<i.dist&&(i.dist=I,i.edge=r,i.point.x=o,i.point.y=s)},e._updateISC=function(t,n,r,i,o,s,f,u){var a=e._P.dist(r,s);if(a<u.dist){var x=1/e._P.dist(i,o),y=-(o.y-i.y)*x,l=(o.x-i.x)*x,h=2*(t*y+n*l);u.dist=a,u.norm.x=y,u.norm.y=l,u.refl.x=-h*y+t,u.refl.y=-h*l+n,u.edge=f}},e._getPoints=function(t,n,e){var r=t.length,i=[];n>e&&(e+=r);for(var o=n;e>=o;o++)i.push(t[o%r]);return i},e._firstWithFlag=function(t,n){for(var e=t.length;;)if(n=(n+1)%e,t[n].flag)return n},e._PointInTriangle=function(t,n,e,r,i,o,s,f){var u=s-e,a=f-r,x=i-e,y=o-r,l=t-e,h=n-r,c=u*u+a*a,v=u*x+a*y,p=u*l+a*h,g=x*x+y*y,_=x*l+y*h,d=1/(c*g-v*v),P=(g*p-v*_)*d,m=(c*_-v*p)*d;return P>=0&&m>=0&&1>P+m},e._RayLineIntersection=function(t,n,r,i,o){var s=t.x-n.x,f=r.x-i.x,u=t.y-n.y,a=r.y-i.y,x=s*a-u*f;if(0==x)return null;var y=t.x*n.y-t.y*n.x,l=r.x*i.y-r.y*i.x,h=o,c=1/x;return h.x=(y*f-s*l)*c,h.y=(y*a-u*l)*c,e._InRect(h,r,i)?u>0&&h.y>t.y||0>u&&h.y<t.y?null:s>0&&h.x>t.x||0>s&&h.x<t.x?null:h:null},e._GetLineIntersection=function(t,n,r,i,o){var s=t.x-n.x,f=r.x-i.x,u=t.y-n.y,a=r.y-i.y,x=s*a-u*f;if(0==x)return null;var y=t.x*n.y-t.y*n.x,l=r.x*i.y-r.y*i.x,h=o;return h.x=(y*f-s*l)/x,h.y=(y*a-u*l)/x,e._InRect(h,t,n)&&e._InRect(h,r,i)?h:null},e._InRect=function(t,n,e){return n.x==e.x?t.y>=Math.min(n.y,e.y)&&t.y<=Math.max(n.y,e.y):n.y==e.y?t.x>=Math.min(n.x,e.x)&&t.x<=Math.max(n.x,e.x):t.x>=Math.min(n.x,e.x)&&t.x<=Math.max(n.x,e.x)&&t.y>=Math.min(n.y,e.y)&&t.y<=Math.max(n.y,e.y)?!0:!1},e._convex=function(t,n,e,r,i,o){return(n-r)*(i-e)+(e-t)*(o-r)>=0},e._P=function(t,n){this.x=t,this.y=n,this.flag=!1},e._P.prototype.toString=function(){return"Point ["+this.x+", "+this.y+"]"},e._P.dist=function(t,n){var e=n.x-t.x,r=n.y-t.y;return Math.sqrt(e*e+r*r)},e._tp=[];for(var r=0;10>r;r++)e._tp.push(new e._P(0,0));"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=n),exports.TRAIL=n):"undefined"!=typeof define&&define.amd?define(n):t.TRAIL=n}).call(this);