(function(){"use strict";var t=this,n=n||{};n.sayHi=function(){console.log("%c trail.js* init \n","background: #ff1234; color: #ffffff")},n.Mesh=function(){this.polygons=[]},n.Mesh.prototype.getPolygons=function(){return this.polygons},n.Mesh.prototype.getPolygon=function(t){return this.polygons[t]},n.Mesh.prototype.addPolygon=function(t){this.polygons.push(t)},n.Mesh.prototype.constructor=n.Mesh,n.Polygon=function(t){this.vertices=[];for(var e=0;e<t.length;e+=2){var r=new n.Vertex(t[e],t[e+1]);this.vertices.push(r)}},n.Polygon.prototype.setVertices=function(t){this.vertices=[];for(var n=0;n<t.length;n++)this.vertices.push(t[n])},n.Polygon.prototype.getVertices=function(){return this.vertices},n.Polygon.prototype.getVertex=function(t){return this.vertices[t]},n.Polygon.prototype.constructor=n.Polygon,n.Vertex=function(t,n){this.x=t,this.y=n},n.Vertex.prototype.constructor=n.Vertex;var e={};e.IsSimple=function(t){var n=t.length>>1;if(4>n)return!0;for(var r=new e._P,i=new e._P,o=new e._P,s=new e._P,u=new e._P,f=0;n>f;f++){r.x=t[2*f],r.y=t[2*f+1],f==n-1?(i.x=t[0],i.y=t[1]):(i.x=t[2*f+2],i.y=t[2*f+3]);for(var a=0;n>a;a++)if(!(Math.abs(f-a)<2||a==n-1&&0==f||f==n-1&&0==a||(o.x=t[2*a],o.y=t[2*a+1],a==n-1?(s.x=t[0],s.y=t[1]):(s.x=t[2*a+2],s.y=t[2*a+3]),null==e._GetLineIntersection(r,i,o,s,u))))return!1}return!0},e.IsConvex=function(t){if(t.length<6)return!0;for(var n=t.length-4,r=0;n>r;r+=2)if(!e._convex(t[r],t[r+1],t[r+2],t[r+3],t[r+4],t[r+5]))return!1;return e._convex(t[n],t[n+1],t[n+2],t[n+3],t[0],t[1])?e._convex(t[n+2],t[n+3],t[0],t[1],t[2],t[3])?!0:!1:!1},e.GetArea=function(t){if(t.length<6)return 0;for(var n=t.length-2,e=0,r=0;n>r;r+=2)e+=(t[r+2]-t[r])*(t[r+1]+t[r+3]);return e+=(t[0]-t[n])*(t[n+1]+t[1]),.5*-e},e.GetAABB=function(t){for(var n=1/0,e=1/0,r=-n,i=-e,o=0;o<t.length;o+=2)n=Math.min(n,t[o]),r=Math.max(r,t[o]),e=Math.min(e,t[o+1]),i=Math.max(i,t[o+1]);return{x:n,y:e,width:r-n,height:i-e}},e.Reverse=function(t){for(var n=[],e=t.length-2;e>=0;e-=2)n.push(t[e],t[e+1]);return n},e.Triangulate=function(t){var n=t.length>>1;if(3>n)return[];for(var r=[],i=[],o=0;n>o;o++)i.push(o);for(var o=0,s=n;s>3;){var u=i[(o+0)%s],f=i[(o+1)%s],a=i[(o+2)%s],y=t[2*u],x=t[2*u+1],l=t[2*f],h=t[2*f+1],c=t[2*a],g=t[2*a+1],p=!1;if(e._convex(y,x,l,h,c,g)){p=!0;for(var v=0;s>v;v++){var _=i[v];if(_!=u&&_!=f&&_!=a&&e._PointInTriangle(t[2*_],t[2*_+1],y,x,l,h,c,g)){p=!1;break}}}if(p)r.push(u,f,a),i.splice((o+1)%s,1),s--,o=0;else if(o++>3*s)break}return r.push(i[0],i[1],i[2]),r},e.ContainsPoint=function(t,n,e){for(var r,i=t.length>>1,o=t[2*i-3]-e,s=t[2*i-2]-n,u=t[2*i-1]-e,f=0;i>f;f++)r=s,o=u,s=t[2*f]-n,u=t[2*f+1]-e,o!=u&&(lup=u>o);for(var a=0,f=0;i>f;f++)if(r=s,o=u,s=t[2*f]-n,u=t[2*f+1]-e,!(0>o&&0>u||o>0&&u>0||0>r&&0>s)){if(o==u&&Math.min(r,s)<=0)return!0;if(o!=u){var y=r+(s-r)*-o/(u-o);if(0==y)return!0;y>0&&a++,0==o&&lup&&u>o&&a--,0==o&&!lup&&o>u&&a--,lup=u>o}}return 1==(1&a)},e.Slice=function(t,n,r,i,o){if(e.ContainsPoint(t,n,r)||e.ContainsPoint(t,i,o))return[t.slice(0)];for(var s=new e._P(n,r),u=new e._P(i,o),f=[],a=[],y=0;y<t.length;y+=2)a.push(new e._P(t[y],t[y+1]));for(var y=0;y<a.length;y++){var x=new e._P(0,0);x=e._GetLineIntersection(s,u,a[y],a[(y+1)%a.length],x),x&&(x.flag=!0,f.push(x),a.splice(y+1,0,x),y++)}if(0==f.length)return[t.slice(0)];var l=function(t,n){return e._P.dist(s,t)-e._P.dist(s,n)};f.sort(l);for(var h=[],c=0;f.length>0;){var g=(a.length,f[0]),p=f[1],v=a.indexOf(g),_=a.indexOf(p),d=!1;if(e._firstWithFlag(a,v)==_?d=!0:(g=f[1],p=f[0],v=a.indexOf(g),_=a.indexOf(p),e._firstWithFlag(a,v)==_&&(d=!0)),d){c--;var P=e._getPoints(a,v,_);h.push(P),a=e._getPoints(a,_,v),g.flag=p.flag=!1,f.splice(0,2),0==f.length&&h.push(a)}else c++,f.reverse();if(c>1)break}for(var m=[],y=0;y<h.length;y++){for(var M=h[y],I=[],w=0;w<M.length;w++)I.push(M[w].x,M[w].y);m.push(I)}return m},e.Raycast=function(t,n,r,i,o,s){var u=t.length-2,f=e._tp,a=f[0],y=f[1],x=f[2],l=f[3],h=f[4];a.x=n,a.y=r,y.x=n+i,y.y=r+o,null==s&&(s={dist:0,edge:0,norm:{x:0,y:0},refl:{x:0,y:0}}),s.dist=1/0;for(var c=0;u>c;c+=2){x.x=t[c],x.y=t[c+1],l.x=t[c+2],l.y=t[c+3];var g=e._RayLineIntersection(a,y,x,l,h);g&&e._updateISC(i,o,a,x,l,h,c/2,s)}x.x=l.x,x.y=l.y,l.x=t[0],l.y=t[1];var g=e._RayLineIntersection(a,y,x,l,h);return g&&e._updateISC(i,o,a,x,l,h,t.length/2,s),1/0!=s.dist?s:null},e.ClosestEdge=function(t,n,r,i){{var o=t.length-2,s=e._tp,u=s[0],f=s[2],a=s[3];s[4]}u.x=n,u.y=r,null==i&&(i={dist:0,edge:0,point:{x:0,y:0},norm:{x:0,y:0}}),i.dist=1/0;for(var y=0;o>y;y+=2)f.x=t[y],f.y=t[y+1],a.x=t[y+2],a.y=t[y+3],e._pointLineDist(u,f,a,y>>1,i);f.x=a.x,f.y=a.y,a.x=t[0],a.y=t[1],e._pointLineDist(u,f,a,o>>1,i);var x=1/i.dist;return i.norm.x=(n-i.point.x)*x,i.norm.y=(r-i.point.y)*x,i},e._pointLineDist=function(t,n,e,r,i){var o,s,u=t.x,f=t.y,a=n.x,y=n.y,x=e.x,l=e.y,h=u-a,c=f-y,g=x-a,p=l-y,v=h*g+c*p,_=g*g+p*p,d=v/_;0>d||a==x&&y==l?(o=a,s=y):d>1?(o=x,s=l):(o=a+d*g,s=y+d*p);var P=u-o,m=f-s,M=Math.sqrt(P*P+m*m);M<i.dist&&(i.dist=M,i.edge=r,i.point.x=o,i.point.y=s)},e._updateISC=function(t,n,r,i,o,s,u,f){var a=e._P.dist(r,s);if(a<f.dist){var y=1/e._P.dist(i,o),x=-(o.y-i.y)*y,l=(o.x-i.x)*y,h=2*(t*x+n*l);f.dist=a,f.norm.x=x,f.norm.y=l,f.refl.x=-h*x+t,f.refl.y=-h*l+n,f.edge=u}},e._getPoints=function(t,n,e){var r=t.length,i=[];n>e&&(e+=r);for(var o=n;e>=o;o++)i.push(t[o%r]);return i},e._firstWithFlag=function(t,n){for(var e=t.length;;)if(n=(n+1)%e,t[n].flag)return n},e._PointInTriangle=function(t,n,e,r,i,o,s,u){var f=s-e,a=u-r,y=i-e,x=o-r,l=t-e,h=n-r,c=f*f+a*a,g=f*y+a*x,p=f*l+a*h,v=y*y+x*x,_=y*l+x*h,d=1/(c*v-g*g),P=(v*p-g*_)*d,m=(c*_-g*p)*d;return P>=0&&m>=0&&1>P+m},e._RayLineIntersection=function(t,n,r,i,o){var s=t.x-n.x,u=r.x-i.x,f=t.y-n.y,a=r.y-i.y,y=s*a-f*u;if(0==y)return null;var x=t.x*n.y-t.y*n.x,l=r.x*i.y-r.y*i.x,h=o,c=1/y;return h.x=(x*u-s*l)*c,h.y=(x*a-f*l)*c,e._InRect(h,r,i)?f>0&&h.y>t.y||0>f&&h.y<t.y?null:s>0&&h.x>t.x||0>s&&h.x<t.x?null:h:null},e._GetLineIntersection=function(t,n,r,i,o){var s=t.x-n.x,u=r.x-i.x,f=t.y-n.y,a=r.y-i.y,y=s*a-f*u;if(0==y)return null;var x=t.x*n.y-t.y*n.x,l=r.x*i.y-r.y*i.x,h=o;return h.x=(x*u-s*l)/y,h.y=(x*a-f*l)/y,e._InRect(h,t,n)&&e._InRect(h,r,i)?h:null},e._InRect=function(t,n,e){return n.x==e.x?t.y>=Math.min(n.y,e.y)&&t.y<=Math.max(n.y,e.y):n.y==e.y?t.x>=Math.min(n.x,e.x)&&t.x<=Math.max(n.x,e.x):t.x>=Math.min(n.x,e.x)&&t.x<=Math.max(n.x,e.x)&&t.y>=Math.min(n.y,e.y)&&t.y<=Math.max(n.y,e.y)?!0:!1},e._convex=function(t,n,e,r,i,o){return(n-r)*(i-e)+(e-t)*(o-r)>=0},e._P=function(t,n){this.x=t,this.y=n,this.flag=!1},e._P.prototype.toString=function(){return"Point ["+this.x+", "+this.y+"]"},e._P.dist=function(t,n){var e=n.x-t.x,r=n.y-t.y;return Math.sqrt(e*e+r*r)},e._tp=[];for(var r=0;10>r;r++)e._tp.push(new e._P(0,0));n.verticesFromPolygon=function(t){for(var n=t.getVertices(),e=[],r=0;r<n.length;r++){var i=n[r];e.push(i.x,i.y)}return e},n.trianglesFromVertexArray=function(t){for(var e=[],r=0;r<t.length/6;r+=6){new n.Polygon([r,r+1,r+2,r+3,r+4,r+5])}return e},n.generateHash=function(t){return t=61^t^t>>16,t+=t<<3,t^=t>>4,t*=668265261,t^=t>>15},"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=n),exports.TRAIL=n):"undefined"!=typeof define&&define.amd?define(n):t.TRAIL=n}).call(this);